<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/layout.html}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .title {
            font-size: 22px;
            font-weight: 700;
            color: #4b3fbf;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .yeoun-subtitle {
            font-size: 13px;
            color: #7b7a93;
            margin-bottom: 20px;
        }

        .yeoun-card {
            border-radius: 12px;
            border: 1px solid #e2e1f3;
            background: #ffffff;
            box-shadow: 0 10px 25px rgba(80, 72, 180, 0.08);
            padding: 16px 18px;
            margin-bottom: 18px;
        }

        .yeoun-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .yeoun-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #41388f;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .chip-date {
            border-radius: 999px;
            background: #f5f4ff;
            color: #5a55a9;
            padding: 4px 12px;
            font-size: 12px;
        }

        .stat-card {
            border-radius: 12px;
            background: linear-gradient(135deg, #6f5cec, #9479ff);
            color: #fff;
            padding: 14px 16px;
            position: relative;
            overflow: hidden;
        }

        .stat-card small {
            font-size: 11px;
            opacity: 0.9;
        }

        .stat-card strong {
            font-size: 20px;
            display: block;
            margin-top: 4px;
        }

        .stat-card.sub {
            background: #ffffff;
            color: #514b9a;
            border: 1px solid #dad7f7;
            box-shadow: 0 8px 20px rgba(60, 50, 160, 0.05);
        }

        .stat-card.sub strong {
            font-size: 18px;
        }

        .status-pill {
            border-radius: 999px;
            font-size: 11px;
            padding: 4px 10px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .status-run {
            background: #e8f7f1;
            color: #138a55;
        }

        .status-stop {
            background: #fdeff1;
            color: #c0392b;
        }

        .status-idle {
            background: #fdf5e6;
            color: #c27b15;
        }

        .status-mt {
            background: #ece7ff;
            color: #5b3fd1;
        }

        .dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: currentColor;
        }

        .table {
            font-size: 13px;
            margin-bottom: 0;
        }

        .table thead {
            background: #f5f4ff;
        }

        .table thead th {
            border-bottom-color: #dad7f5;
            color: #5b568a;
            font-weight: 600;
        }

        .table tbody tr {
            vertical-align: middle;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .table tbody tr:hover {
            background: #f7f6ff;
        }

        .badge-kpi {
            border-radius: 999px;
            font-size: 11px;
            padding: 3px 8px;
        }

        .badge-kpi-good {
            background: #e8f7f1;
            color: #138a55;
        }

        .badge-kpi-warn {
            background: #fff7e5;
            color: #c28a11;
        }

        .badge-kpi-bad {
            background: #fdeff1;
            color: #c0392b;
        }

        .btn-yeoun-outline {
            border-radius: 999px;
            border: 1px solid #c9c6f3;
            background: #fff;
            color: #655dc0;
            font-size: 13px;
            padding: 6px 12px;
        }

        .btn-yeoun-outline i {
            font-size: 14px;
        }

        /* 모달 내부 */
        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #41388f;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: #5b568a;
            margin-bottom: 6px;
            margin-top: 10px;
        }

        .small-text {
            font-size: 12px;
            color: #8b88aa;
        }
    </style>
</head>
<body>
<th:block layout:fragment="content">
    <div class="custom-body container-xxl flex-grow-1 container-p-y">
        <div class="mb-3">
            <div class="title">
                <i class="bi bi-kanban-fill"></i>
                라인 운영 현황
            </div>
        </div>

        <!-- 상단 KPI 카드 -->
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="stat-card">
                    <small>전체 라인 가동률</small>
                    <strong>87%</strong>
                    <span class="small-text">목표 85% 대비 양호</span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card sub">
                    <small>오늘 가동 라인 수</small>
                    <strong>2 / 3</strong>
                    <span class="small-text">1라인, 2라인 가동 중 · 예비라인 대기</span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card sub">
                    <small>비가동(점검/고장) 라인</small>
                    <strong>1</strong>
                    <span class="small-text">점검 등록 필요 시 우측 메뉴에서 처리</span>
                </div>
            </div>
        </div>

        <!-- 본문: 라인 리스트 -->
        <div class="yeoun-card">
            <div class="yeoun-card-header">
                <div class="yeoun-card-title">
                    <i class="bi bi-kanban"></i>
                    오늘 라인별 운영 상태
                </div>
                <div class="d-flex align-items-center gap-2">
              <span class="chip-date">
                <i class="bi bi-calendar-week me-1"></i>2025-12-02 기준
              </span>
                    <!-- 나중에 날짜 선택기 붙일 자리 -->
                </div>
            </div>

            <div class="table-responsive">
                <table class="table align-middle">
                    <thead>
                    <tr>
                        <th>라인</th>
                        <th>상태</th>
                        <th>오늘 작업지시</th>
                        <th>계획량 / 완료량</th>
                        <th>가동률</th>
                        <th>작업자</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 라인 1: 정상 가동 -->
                    <tr data-line="1라인" data-bs-toggle="modal" data-bs-target="#lineDetailModal">
                        <td>1라인</td>
                        <td>
                  <span class="status-pill status-run">
                    <span class="dot"></span> 가동중
                  </span>
                        </td>
                        <td>라벤더 퍼퓸 50ml, 시트러스 코롱 100ml</td>
                        <td class="text-end">400 / 320</td>
                        <td>
                            <span class="badge-kpi badge-kpi-good">89%</span>
                        </td>
                        <td>3명</td>
                        <td class="text-end">
                            <button type="button"
                                    class="btn-yeoun-outline btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#lineDetailModal">
                                상세보기
                            </button>
                        </td>
                    </tr>

                    <!-- 라인 2: 부분 가동 / 품목 변경 -->
                    <tr data-line="2라인" data-bs-toggle="modal" data-bs-target="#lineDetailModal">
                        <td>2라인</td>
                        <td>
                  <span class="status-pill status-idle">
                    <span class="dot"></span> 대기중
                  </span>
                        </td>
                        <td>바닐라 퍼퓸 30ml (오후 투입 예정)</td>
                        <td class="text-end">250 / 0</td>
                        <td>
                            <span class="badge-kpi badge-kpi-warn">31%</span>
                        </td>
                        <td>2명</td>
                        <td class="text-end">
                            <button type="button"
                                    class="btn-yeoun-outline btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#lineDetailModal">
                                상세보기
                            </button>
                        </td>
                    </tr>

                    <!-- 라인 3: 점검/비가동 -->
                    <tr data-line="예비라인" data-bs-toggle="modal" data-bs-target="#lineDetailModal">
                        <td>예비라인</td>
                        <td>
                  <span class="status-pill status-mt">
                    <span class="dot"></span> 점검중
                  </span>
                        </td>
                        <td>—</td>
                        <td class="text-end">0 / 0</td>
                        <td>
                            <span class="badge-kpi badge-kpi-bad">0%</span>
                        </td>
                        <td>0명</td>
                        <td class="text-end">
                            <button type="button"
                                    class="btn-yeoun-outline btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#lineDetailModal">
                                상세보기
                            </button>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- 라인 운영 상세 모달 -->
    <div class="modal fade" id="lineDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">
                        라인 운영 상세
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- 라인 기본 정보 -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <div class="section-title">라인 기본 정보</div>
                            <div class="small-text" id="lineBasicText">
                                1라인 · 충진/혼합 설비 2대 · 오늘 작업자 3명 투입
                            </div>
                        </div>
                        <div>
            <span class="status-pill status-run" id="lineStatusPill">
              <span class="dot"></span> 가동중
            </span>
                        </div>
                    </div>

                    <hr class="my-2"/>

                    <!-- 오늘 작업지시 -->
                    <div>
                        <div class="section-title">오늘 작업지시</div>
                        <div class="small-text mb-1">
                            해당 라인에 배정된 작업지시 목록이 보여지고, 클릭 시 작업지시 상세로 이동할 수 있어.
                        </div>

                        <div class="table-responsive mb-2">
                            <table class="table table-sm align-middle">
                                <thead>
                                <tr>
                                    <th style="width: 120px;">작업지시번호</th>
                                    <th>품목</th>
                                    <th style="width: 140px;">계획시간</th>
                                    <th style="width: 80px;" class="text-end">수량</th>
                                    <th style="width: 100px;">상태</th>
                                </tr>
                                </thead>
                                <tbody id="lineWoTableBody">
                                <tr>
                                    <td>WO-20251202-01</td>
                                    <td>라벤더 퍼퓸 50ml</td>
                                    <td>10:00 ~ 12:00</td>
                                    <td class="text-end">250</td>
                                    <td>
                                        <span class="badge bg-success-subtle text-success-emphasis">In Progress</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>WO-20251202-03</td>
                                    <td>시트러스 코롱 100ml</td>
                                    <td>16:00 ~ 18:00</td>
                                    <td class="text-end">150</td>
                                    <td>
                                        <span class="badge bg-warning-subtle text-warning-emphasis">Planned</span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <hr class="my-2"/>

                    <!-- 비가동 / 점검 등록 -->
                    <div>
                        <div class="section-title">비가동 / 점검 등록</div>
                        <div class="small-text mb-1">
                            라인이 멈춘 경우, 사유와 시간을 기록하면 가동률·스케줄에 반영할 수 있어.
                        </div>

                        <form>
                            <div class="row g-2 mb-2">
                                <div class="col-md-4">
                                    <label class="form-label">비가동 유형</label>
                                    <select class="form-select form-select-sm">
                                        <option value="">선택</option>
                                        <option>점검(Maintenance)</option>
                                        <option>고장(Breakdown)</option>
                                        <option>자재 부족</option>
                                        <option>작업자 부족</option>
                                        <option>기타</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">시작 시간</label>
                                    <input type="datetime-local" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">종료 시간</label>
                                    <input type="datetime-local" class="form-control form-control-sm">
                                </div>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">비고</label>
                                <textarea class="form-control form-control-sm" rows="2"
                                          placeholder="점검 내용, 고장 원인 등"></textarea>
                            </div>
                        </form>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-outline-secondary"
                            data-bs-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-sm btn-primary">
                        <i class="bi bi-clipboard-check me-1"></i> 비가동 등록
                    </button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block layout:fragment="myScript">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 간단한 프로토타입용 JS:
        // 클릭한 행의 라인명에 따라 모달 상단 텍스트만 바꿔주는 정도
        const lineDetailModal = document.getElementById('lineDetailModal');
        lineDetailModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            // tr 또는 버튼에 data-line 속성이 있다고 가정
            const tr = button.closest('tr');
            const lineName = tr ? tr.dataset.line : '1라인';

            const title = lineDetailModal.querySelector('.modal-title');
            const basicText = lineDetailModal.querySelector('#lineBasicText');

            title.textContent = `라인 운영 상세 - ${lineName}`;
            basicText.textContent = `${lineName} · 오늘 기준 작업자 및 설비 구성, 작업지시 현황을 보여줍니다.`;
        });
    </script>
</th:block>
</body>
</html>